<h1>Petition admin</h1>

<div class="grid-row">
  <%= render 'admin/searches/form', query: '' %>

  <div class="column-two-thirds">
    <div class="hub-actions grid-row">
      <div class="moderation">
        <% nearly_overdue_count = nearly_overdue_moderation_count %>
        <% overdue_count = overdue_moderation_count %>

        <%= link_to admin_petitions_url(state: :in_moderation) do %>
          <% summary_class_name = summary_class_name_for_counts(nearly_overdue_count, overdue_count) %>
          <div class="<%= "panel #{summary_class_name}" %>">
            <div class="summary">
              <div class="count">
                <%= in_moderation_count %>
              </div>
              Moderation queue
            </div>
          </div>

          <div class="panel">
            <div class="details">
              <div class="recently-in-moderation queue-stable">
                <%= recently_in_moderation_count %><span class="label">0-5 days</span>
              </div>

              <div class="<%= "nearly-overdue-moderation #{nearly_overdue_count > 0 ? 'queue-caution' : 'queue-stable'}" %>">
                <%= nearly_overdue_moderation_count %><span class="label">6-7 days</span>
              </div>

              <div class="<%= "overdue-moderation #{overdue_count > 0 ? 'queue-danger': 'queue-stable'}" %>">
                <%= overdue_moderation_count %><span class="label">&gt; 7 days</span>
              </div>

              <div class="tagged">
                <%= tagged_count %><span class="label">Tagged</span>
              </div>
            </div>
          </div>
        <% end %>
      </div>

      <ul>
        <% action_counts do |counts| %>
          <% counts.each do |state, count| %>
            <li class="column-half action-<%= state.to_s.dasherize %>">
              <%= link_to admin_petitions_url(state: state) do %>
                <% if state == :awaiting_response %>
                  <span class="graphic graphic-crest-large-white"></span>
                <% elsif state == :in_debate_queue %>
                  <span class="graphic graphic-portcullis-large-white"></span>
                <% end %>
                <%= action_count(state, count) %>
              <% end %>
            </li>
          <% end %>
        <% end %>
      </ul>

      <%= link_to "All Petitions (#{petition_total_count})", admin_petitions_url(state: :all), class: 'all-petitions-link' %>
      </div>
  </div>

  <div class="signature-trends column-third">
    <% if current_user.is_a_sysadmin? %>
      <dl>
        <% if trending_domains? %>
          <dt>Trending domains</dt>
          <dd>
            <table class="trending-domains">
              <% trending_domains.each do |domain, count| %>
                <tr>
                  <td><%= domain %></td>
                  <td><%= number_with_delimiter(count) %></td>
                </tr>
              <% end %>
            </table>
          </dd>
        <% end %>

        <% if trending_ips? %>
          <dt>Trending IP addresses</dt>
          <dd>
            <table class="trending-ips">
              <% trending_ips.each do |ip, count| %>
                <tr>
                  <td><%= ip %></td>
                  <td><%= number_with_delimiter(count) %></td>
                </tr>
              <% end %>
            </table>
          </dd>
        <% end %>
      </dl>
    <% end %>
  </div>
</div>
